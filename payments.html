<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payment</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet"> -->
  <!-- <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .ticket {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .ticket h2 {
      color: #1e3c72;
    }
    .btn-pay {
      background: #ff7b00;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn-pay:hover {
      background: #ff9900;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #1e3c72;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style> -->
<!-- </head>
<body>
  <div class="ticket" id="ticketDetails">
    <h2>Ticket Details</h2>
    <p><strong>Booking ID:</strong> <span id="bookingId"></span></p>
    <p><strong>Flight ID:</strong> <span id="flightId"></span></p>
    <p><strong>Flight Name:</strong> <span id="flightNameDisplay"></span></p>
    <p><strong>Flight Number:</strong> <span id="flightNumberDisplay"></span></p>
    <p><strong>Seat:</strong> <span id="seatNumber"></span></p>
    <p><strong>Price:</strong> ₹<span id="ticketPrice"></span></p>
  </div>
  <select id="paymentMethod">
    <option value="">Select Payment Method</option>
    <option value="Credit Card">Credit Card</option>
    <option value="Debit Card">Debit Card</option>
    <option value="UPI">UPI</option>
    <option value="Net Banking">Net Banking</option>
  </select>
  <br /><br />
  <button class="btn-pay" id="payButton">Pay</button>
  <div class="spinner" id="spinner"></div>
   -->
  <!-- <script>
    // Extract URL parameters for booking details
    const urlParams = new URLSearchParams(window.location.search);
    const bookingId = urlParams.get("bookingId");
    const flightId = urlParams.get("flightId");
    const seatNumber = urlParams.get("seat");
    const price = urlParams.get("price");
    const userId = urlParams.get("userId");
    const flightName = urlParams.get("flightName") || "N/A";
    const flightNumber = urlParams.get("flightNumber") || "N/A";

    // Populate ticket details on the page
    document.getElementById("bookingId").innerText = bookingId;
    document.getElementById("flightId").innerText = flightId;
    document.getElementById("seatNumber").innerText = seatNumber;
    document.getElementById("ticketPrice").innerText = price;
    // Populate flight name and flight number
    document.getElementById("flightNameDisplay").innerText = flightName;
    document.getElementById("flightNumberDisplay").innerText = flightNumber;

    document.getElementById("payButton").addEventListener("click", async () => {
      const paymentMethod = document.getElementById("paymentMethod").value;
      if (!paymentMethod) {
        alert("Please select a payment method!");
        return;
      }
      
      // Show spinner while processing payment
      document.getElementById("spinner").style.display = "block";
      
      const paymentData = {
        booking_id: bookingId,
        user_id: userId,
        amount_paid: price,
        payment_method: paymentMethod,
        transaction_id: "TXN" + Date.now()
      };

      try {
        const response = await fetch("http://localhost:3000/payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(paymentData)
        });
        const result = await response.json();
        
        // Hide spinner after payment processing
        document.getElementById("spinner").style.display = "none";
        console.log("Response ok:", response.ok);
        if (response.ok) {
          alert(result.message);  // "Payment processed successfully!"
          // Redirect to confirmation page with all ticket details passed in URL parameters
          window.location.href = `confirmation.html?bookingId=${bookingId}&flightName=${encodeURIComponent(flightName)}&flightNumber=${encodeURIComponent(flightNumber)}&seat=${encodeURIComponent(seatNumber)}&price=${encodeURIComponent(price)}`;
        } else {
          alert("Payment failed: " + result.message);
        }
      } catch (error) {
        document.getElementById("spinner").style.display = "none";
        console.error("Payment error:", error);
        alert("An error occurred during payment.");
      }
    });
  </script>
</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payment</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f2f2f2;
      padding: 20px;
    }
    .ticket {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .ticket h2 {
      color: #1e3c72;
    }
    .ticket p {
      margin: 5px 0;
    }
    .btn-pay {
      background: #ff7b00;
      color: #fff;
      padding: 12px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn-pay:hover {
      background: #ff9900;
    }
    .spinner {
      display: none;
      margin: 20px auto;
      border: 6px solid #f3f3f3;
      border-top: 6px solid #1e3c72;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="ticket" id="ticketDetails">
    <h2>Ticket Details</h2>
    <p><strong>Booking ID:</strong> <span id="bookingId"></span></p>
    <p><strong>Flight ID:</strong> <span id="flightId"></span></p>
    <p><strong>Airline Name:</strong> <span id="airlineNameDisplay"></span></p>
    <p><strong>Flight Name:</strong> <span id="flightNameDisplay"></span></p>
    <p><strong>Flight Number:</strong> <span id="flightNumberDisplay"></span></p>
    <p><strong>From:</strong> <span id="sourceDisplay"></span></p>
    <p><strong>To:</strong> <span id="destinationDisplay"></span></p>
    <p><strong>Departs:</strong> <span id="departureTimeDisplay"></span></p>
    <p><strong>Arrives:</strong> <span id="arrivalTimeDisplay"></span></p>
    <p><strong>Seat:</strong> <span id="seatNumber"></span></p>
    <p><strong>Price:</strong> ₹<span id="ticketPrice"></span></p>
  </div>
  
  <select id="paymentMethod">
    <option value="">Select Payment Method</option>
    <option value="Credit Card">Credit Card</option>
    <option value="Debit Card">Debit Card</option>
    <option value="UPI">UPI</option>
    <option value="Net Banking">Net Banking</option>
  </select>
  <br /><br />
  <button class="btn-pay" id="payButton">Pay</button>
  <div class="spinner" id="spinner"></div>
  
  <script>
    // Extract URL parameters for booking details (including full flight info)
    const urlParams = new URLSearchParams(window.location.search);
    const bookingId = urlParams.get("bookingId");
    const flightId = urlParams.get("flightId");
    const seatNumber = urlParams.get("seat");
    const price = urlParams.get("price");
    const userId = urlParams.get("userId");
    const airlineName = urlParams.get("airlineName") || "N/A";
    const flightName = urlParams.get("flightName") || "N/A";
    const flightNumber = urlParams.get("flightNumber") || "N/A";
    const source = urlParams.get("source") || "N/A";
    const destination = urlParams.get("destination") || "N/A";
    const departureTime = urlParams.get("departureTime") || "N/A";
    const arrivalTime = urlParams.get("arrivalTime") || "N/A";

    // Populate ticket details on the page
    document.getElementById("bookingId").innerText = bookingId;
    document.getElementById("flightId").innerText = flightId;
    document.getElementById("seatNumber").innerText = seatNumber;
    document.getElementById("ticketPrice").innerText = price;
    document.getElementById("airlineNameDisplay").innerText = airlineName;
    document.getElementById("flightNameDisplay").innerText = flightName;
    document.getElementById("flightNumberDisplay").innerText = flightNumber;
    document.getElementById("sourceDisplay").innerText = source;
    document.getElementById("destinationDisplay").innerText = destination;
    document.getElementById("departureTimeDisplay").innerText = departureTime;
    document.getElementById("arrivalTimeDisplay").innerText = arrivalTime;

    document.getElementById("payButton").addEventListener("click", async () => {
      const paymentMethod = document.getElementById("paymentMethod").value;
      if (!paymentMethod) {
        alert("Please select a payment method!");
        return;
      }
      
      // Show spinner while processing payment
      document.getElementById("spinner").style.display = "block";
      
      const paymentData = {
        booking_id: bookingId,
        user_id: userId,
        amount_paid: price,
        payment_method: paymentMethod,
        transaction_id: "TXN" + Date.now()
      };

      try {
        const response = await fetch("http://localhost:3000/payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(paymentData)
        });
        const result = await response.json();
        
        // Hide spinner after payment processing
        document.getElementById("spinner").style.display = "none";
        console.log("Response ok:", response.ok);
        if (response.ok) {
          alert(result.message);  // e.g., "Payment processed successfully!"
          // Redirect to confirmation page with all ticket details in URL parameters
          window.location.href = `confirmation.html?bookingId=${bookingId}&airlineName=${encodeURIComponent(airlineName)}&flightName=${encodeURIComponent(flightName)}&flightNumber=${encodeURIComponent(flightNumber)}&source=${encodeURIComponent(source)}&destination=${encodeURIComponent(destination)}&departureTime=${encodeURIComponent(departureTime)}&arrivalTime=${encodeURIComponent(arrivalTime)}&seat=${encodeURIComponent(seatNumber)}&price=${encodeURIComponent(price)}`;
        } else {
          alert("Payment failed: " + result.message);
        }
      } catch (error) {
        document.getElementById("spinner").style.display = "none";
        console.error("Payment error:", error);
        alert("An error occurred during payment.");
      }
    });
  </script>
</body>
</html>
